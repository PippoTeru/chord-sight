// 標準コードマップ
// chord-detection-spec-v3.md に基づく実装

export type ChordMap = Record<string, string>;

/**
 * 標準コードマップを取得
 * インターバルパターン → コード名（ルートなし）
 */
export function getStandardChordMap(): ChordMap {
  return {
    // パワーコード（2音）
    "0,7": "5",

    // トライアド（3和音）
    "0,4,7": "",           // メジャー
    "0,3,7": "m",          // マイナー
    "0,4,6": "(-5)",       // フラット5
    "0,3,6": "dim",        // ディミニッシュ
    "0,4,8": "aug",        // オーグメント
    "0,5,7": "sus4",       // サスペンデッド4
    "0,2,7": "sus2",       // サスペンデッド2

    // セブンスコード（4和音）
    "0,4,7,9": "6",        // メジャー6th
    "0,3,7,9": "m6",       // マイナー6th
    "0,4,7,10": "7",       // ドミナント7th
    "0,3,7,10": "m7",      // マイナー7th
    "0,4,7,11": "M7",      // メジャー7th
    "0,3,7,11": "mM7",     // マイナーメジャー7th
    "0,4,6,10": "7(-5)",   // ドミナント7thフラット5
    "0,3,6,10": "m7(-5)",  // ハーフディミニッシュ
    "0,4,6,11": "M7(-5)",  // メジャー7thフラット5
    "0,3,6,11": "mM7(-5)", // マイナーメジャー7thフラット5
    "0,5,7,10": "7sus4",   // ドミナント7thサス4
    "0,3,6,9": "dim7",     // ディミニッシュ7th
    "0,2,4,7": "add9",     // アド9th
    "0,2,3,7": "madd9",    // マイナーアド9th
    "0,4,5,7": "add4",     // アド4th
    "0,4,8,10": "aug7",    // オーグメント7th

    // 9thコード（5音）
    "0,2,4,7,10": "9",     // ドミナント9th
    "0,2,3,7,10": "m9",    // マイナー9th
    "0,2,4,7,11": "M9",    // メジャー9th
    "0,2,3,7,11": "mM9",   // マイナーメジャー9th
    "0,2,4,7,9": "69",     // 6/9コード
    "0,2,3,7,9": "m69",    // マイナー6/9

    // 11thコード（6音）
    "0,2,4,5,7,10": "11",   // ドミナント11th
    "0,2,3,5,7,10": "m11",  // マイナー11th
    "0,2,4,5,7,11": "M11",  // メジャー11th
    "0,2,3,5,7,11": "mM11", // マイナーメジャー11th

    // 13thコード（7音）
    "0,2,4,5,7,9,10": "13",    // ドミナント13th
    "0,2,3,5,7,9,10": "m13",   // マイナー13th
    "0,2,4,5,7,9,11": "M13",   // メジャー13th
    "0,2,3,5,7,9,11": "mM13",  // マイナーメジャー13th

    // 特殊コード
    "0,3,4,10": "+9(omit5)", // ジミヘンコード
  };
}

/**
 * 音名 → 半音数の変換テーブル
 */
export const chord2num: Record<string, number> = {
  "c": 0,
  "b#": 0,
  "c#": 1,
  "d♭": 1,
  "d": 2,
  "d#": 3,
  "e♭": 3,
  "e": 4,
  "f♭": 4,
  "e#": 5,
  "f": 5,
  "f#": 6,
  "g♭": 6,
  "g": 7,
  "g#": 8,
  "a♭": 8,
  "a": 9,
  "a#": 10,
  "b♭": 10,
  "b": 11,
  "c♭": 11,
};

/**
 * 半音数 → 音名の変換テーブル（#統一）
 */
export const num2chord: Record<number, string> = {
  0: "C",
  1: "C#",
  2: "D",
  3: "D#",
  4: "E",
  5: "F",
  6: "F#",
  7: "G",
  8: "G#",
  9: "A",
  10: "A#",
  11: "B",
};

/**
 * 半音数 → 音名の変換テーブル（♭統一）
 */
export const num2chordFlat: Record<number, string> = {
  0: "C",
  1: "D♭",
  2: "D",
  3: "E♭",
  4: "E",
  5: "F",
  6: "G♭",
  7: "G",
  8: "A♭",
  9: "A",
  10: "B♭",
  11: "B",
};

/**
 * 設定に応じた音名変換テーブルを取得
 */
export function getNum2Chord(useFlat: boolean): Record<number, string> {
  return useFlat ? num2chordFlat : num2chord;
}
